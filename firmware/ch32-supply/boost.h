//------------------------------------------------------------------------------
//       Filename: boost.h
//------------------------------------------------------------------------------
//       Bogdan Ionescu (c) 2024
//------------------------------------------------------------------------------
//       Purpose : Defines the Boost Converter API
//------------------------------------------------------------------------------
//       Notes : None
//------------------------------------------------------------------------------
#pragma once

#ifdef __cplusplus
extern "C" {
#endif

//------------------------------------------------------------------------------
// Module includes
//------------------------------------------------------------------------------
#include "funconfig.h"
#include <assert.h>
#include <stdint.h>

//------------------------------------------------------------------------------
// Module exported defines
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
// Module exported type definitions
//------------------------------------------------------------------------------
typedef struct __attribute__((packed))
{
    uint16_t voltage;
    uint16_t current;
    uint8_t duty;
    uint8_t ccMode;
} BoostState_t;

static_assert(sizeof(BoostState_t) <= BOOST_REPORT_SIZE, "BoostState_t too big, adjust BOOST_REPORT_SIZE in usb_config.h");

//------------------------------------------------------------------------------
// Module exported functions
//------------------------------------------------------------------------------
void BoostPWM_Init(void);
void BoostPWM_SetVoltageTarget(uint32_t millivolts);
void BoostPWM_SetCurrentLimit(uint32_t milliamps);
void BoostPWM_GetState(BoostState_t *state);

//------------------------------------------------------------------------------
// Module exported variables
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------

#ifdef __cplusplus
}
#endif
